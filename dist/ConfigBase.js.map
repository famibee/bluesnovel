{"version":3,"file":"ConfigBase.js","sources":["../src/ts/ConfigBase.ts"],"sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\n\tCopyright (c) 2022-2025 Famibee (famibee.blog38.fc2.com)\n\n\tThis software is released under the MIT License.\n\thttp://opensource.org/licenses/mit-license.php\n** ***** END LICENSE BLOCK ***** */\n\nimport {int} from './CmnLib';\n\nexport const enum SEARCH_PATH_ARG_EXT {\t// #searchPath 使用時、第二引数用\n\tDEFAULT\t= '',\n\tSP_GSM\t= 'png|jpg|jpeg|json|svg|webp|mp4|webm',\n\tSCRIPT\t= 'sn|ssn',\n\tFONT\t= 'woff2|woff|otf|ttf',\n\tSOUND\t= 'mp3|m4a|ogg|aac|flac|wav',\n\tHTML\t= 'htm|html',\n\tCSS\t\t=\t'css',\n\tSN\t\t=\t'sn',\n\n\tTST_PNGPNG_\t= 'png|png_',\n\tTST_HH\t\t= 'hh',\n\tTST_EEE\t\t= 'eee',\n\tTST_GGG\t\t= 'ggg',\n\tTST_PNGXML\t= 'png|xml',\n};\n\n\nexport type T_CFG = {\n\tbook\t: {\n\t\ttitle\t\t: string,\t// 作品タイトル\n\t\tcreator\t\t: string,\t// 著作者\n\t\tcre_url\t\t: string,\t// 連絡先URL\n\t\tpublisher\t: string,\t// 出版者\n\t\tpub_url\t\t: string,\t// 出版社URL\n\t\tdetail\t\t: string,\t// 内容紹介\n\t\tversion\t\t: string,\t// version\n\t},\n\tsave_ns\t\t: string,\n\twindow\t: {\t\t// アプリケーションウインドウサイズ\n\t\twidth\t: number,\n\t\theight\t: number,\n\t},\n\tlog\t\t: {max_len: number},\t// プレイヤーが読んだ文章を読み返せる履歴の長さ\n\tinit\t: {\n\t\tbg_color\t\t\t: string,\t// 背景色\n\t\ttagch_msecwait\t\t: number,\t// 通常文字表示待ち時間（未読／既読）\n\t\tauto_msecpagewait\t: number,\t// 自動文字表示、行待ち時間（未読／既読）\n\t\tescape\t\t\t\t: string,\t// エスケープ文字\n\t},\n\tdebug\t: {\t// デバッグ情報\n\t\tdevtool\t\t: boolean,\n\t\tdumpHtm\t\t: boolean,\t// テキストレイヤ：HTML部分をファイル出力するか\n\t\ttoken\t\t: boolean,\n\t\ttag\t\t\t: boolean,\n\t\tputCh\t\t: boolean,\n\t\tdebugLog\t: boolean,\n\t\tbaseTx\t\t: boolean,\n\t\tmasume\t\t: boolean,\t// テキストレイヤ：ガイドマス目を表示するか\n\t\tvariable\t: boolean,\n\t},\n\tcode\t: {[fold_nm: string]: boolean,},\t// 暗号化しないフォルダ\n\tdebuger_token\t: string,\t// デバッガとの接続トークン\n}\n\nexport\tconst DEF_CFG: T_CFG = {\n\tsave_ns\t\t: '',\t\t// 扱うセーブデータを一意に識別するキーワード文字列\n\twindow\t: {\t\t// アプリケーションウインドウサイズ\n\t\twidth\t: 300,\n\t\theight\t: 300,\n\t},\n\tbook\t: {\t\t// プロジェクトの詳細情報です\n\t\ttitle\t\t: '',\t//作品タイトル\n\t\tcreator\t\t: '',\t//著作者。同人ならペンネーム\n\t\tcre_url\t\t: '',\t//著作者URL。ツイッターやメール、サイトなど\n\t\tpublisher\t: '',\t//出版社。同人ならサークル名\n\t\tpub_url\t\t: '',\t//出版社URL。無ければ省略します\n\t\tdetail\t\t: '',\t// 内容紹介。端的に記入\n\t\tversion\t\t: '1.0',\n\t},\n\tlog\t\t: {max_len: 64},\t// プレイヤーが読んだ文章を読み返せる履歴のページ数\n\tinit\t: {\n\t\tbg_color\t\t\t: '#000000',\t// 背景色\n\t\ttagch_msecwait\t\t: 10,\t\t// 通常文字表示待ち時間（未読／既読）\n\t\tauto_msecpagewait\t: 3500,\t\t// 自動文字表示、行クリック待ち時間（未読／既読）\n\t\tescape\t\t\t\t: '',\t\t// エスケープ文字\n\t},\n\tdebug\t: {\n\t\tdevtool\t\t: false,\n\t\ttoken\t\t: false,\n\t\ttag\t\t\t: false,\n\t\tputCh\t\t: false,\n\t\tdebugLog\t: false,\n\t\tbaseTx\t\t: false,\n\t\tmasume\t\t: false,\t// テキストレイヤ：ガイドマス目を表示するか\n\t\tvariable\t: false,\n\t\tdumpHtm\t: false,\n\t},\n\tcode\t: {},\t// 暗号化しないフォルダ\n\tdebuger_token\t: '',\t\t// デバッガとの接続トークン\n};\n\n\n\nexport interface IExts { [ext: string]: string; };\nexport interface IFn2Path { [fn: string]: IExts; };\n\nexport type T_SEARCHPATH = (fn: string, extptn?: SEARCH_PATH_ARG_EXT)=> string;\nexport interface IConfig {\n\toCfg\t: T_CFG;\n\tgetNs()\t: string;\n\tsearchPath: T_SEARCHPATH;\n\tmatchPath(fnptn: string, extptn?: SEARCH_PATH_ARG_EXT): ReadonlyArray<IExts>;\n\taddPath(fn: string, h_exts: IExts): void;\n}\n\nexport interface ISysRoots {\n\tloadPath(hPathFn2Exts: IFn2Path, cfg: IConfig): Promise<void>;\n\tdec(ext: string, tx: string): Promise<string>;\n\t// decAB(ab: ArrayBuffer): Promise<HTMLImageElement | HTMLVideoElement | ArrayBuffer>;\n\n\targ: HSysBaseArg;\n\tfetch(url: string): Promise<Response>;\t// ハッシュ値作成ロード用\n\thash(str: string): string;\n}\nexport type HSysBaseArg = {\n\tcur\t\t: string;\n\tcrypto\t: boolean;\n\tdip\t\t: string;\n}\n\n\nexport class ConfigBase implements IConfig {\n\toCfg\t= DEF_CFG;\n\n\tuserFnTail\t\t= '';\t// 4tst public\n\tprotected\thPathFn2Exts\t: IFn2Path\t= {};\n\n\tprotected\tconstructor(readonly sys: ISysRoots) {}\n\tprotected\tasync load(oCfg: T_CFG) {\n\t\t// this.oCfg = {...this.oCfg, ...oCfg};\t// 一階層目でコピーしてしまう\n\t\tthis.oCfg.save_ns = oCfg?.save_ns ?? this.oCfg.save_ns;\n\n\t\tthis.oCfg.window.width = Number(oCfg?.window?.width ?? this.oCfg.window.width);\n\t\tthis.oCfg.window.height = Number(oCfg?.window?.height ?? this.oCfg.window.height);\n\n\t\tthis.oCfg.book = {...this.oCfg.book, ...oCfg.book};\n\n\t\tthis.oCfg.log.max_len = oCfg.log?.max_len ?? this.oCfg.log.max_len;\n\n\t\tthis.oCfg.init = {...this.oCfg.init, ...oCfg.init};\n\n\t\tthis.oCfg.debug = {...this.oCfg.debug, ...oCfg.debug};\n\n\t\tthis.oCfg.debuger_token = oCfg.debuger_token;\n\n\t\t// これが同期（App）非同期（Web、path.json）混在してるので、\n\t\t// （Mainのメンバ変数に入れる→他のクラスに渡す都合により）\n\t\t// 当クラスのコンストラクタとload()は分ける\n\t\tawait this.sys.loadPath(this.hPathFn2Exts, this);\n\n\t\tthis.#existsBreakline = this.matchPath('^breakline$', SEARCH_PATH_ARG_EXT.SP_GSM).length > 0;\n\t\tthis.#existsBreakpage = this.matchPath('^breakpage$', SEARCH_PATH_ARG_EXT.SP_GSM).length > 0;\n\n\t\tconst hFn2Ext: {[fn: string]: string}\t= {};\n\t\tif (! this.sys.arg.crypto) {\n\t\t\tfor (const [fn0, hExts] of Object.entries(this.hPathFn2Exts)) {\n\t\t\t\tfor (const ext of Object.keys(hExts)) {\n\t\t\t\t\tif (ext.startsWith(':')) continue;\n\t\t\t\t\thFn2Ext[fn0] = ext;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\tfor (const [fn0, hExts] of Object.entries(this.hPathFn2Exts)) {\n\t\t\tfor (const [ext, v] of Object.entries(hExts)) {\n\t\t\t\tif (! ext.startsWith(':')) {\n\t\t\t\t\thFn2Ext[fn0] = ext;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (! ext.endsWith(':id')) continue;\n\t\t\t\tconst hp = v.slice(v.lastIndexOf('/') +1);\n\t\t\t\tconst fn = hExts[ext.slice(0, -10)] ?? '';\n\t\t\t\tconst res = await this.sys.fetch(fn);\n\t\t\t\tconst src = await res.text();\n\t\t\t\tconst hf = this.sys.hash(src);\n\t\t\t\tif (hp !== hf) throw `ファイル改竄エラーです fn:${fn}`;\n\t\t\t}\n\t\t}\n\t}\n\t#existsBreakline = false;\n\tget existsBreakline(): boolean {return this.#existsBreakline}\n\t#existsBreakpage = false;\n\tget existsBreakpage(): boolean {return this.#existsBreakpage}\n\n\tgetNs() {return `skynovel.${this.oCfg.save_ns} - `}\n\n\treadonly\t#REG_PATH = /([^\\/\\s]+)\\.([^\\d]\\w+)/;\n\t\t// 4 match 498 step(~1ms)  https://regex101.com/r/tpVgmI/1\n\tsearchPath(fn: string, extptn: SEARCH_PATH_ARG_EXT = SEARCH_PATH_ARG_EXT.DEFAULT): string {\n\t\tif (! fn) throw '[searchPath] fnが空です';\n\t\tif (fn.startsWith('http://')) return fn;\n\n\t\tconst a = fn.match(this.#REG_PATH);\n\t\tlet fn0 = a ?a[1] :fn;\n\t\tconst ext = a ?a[2] :'';\n\t\tif (this.userFnTail) {\n\t\t\tconst utn = fn0 +'@@'+ this.userFnTail;\n\t\t\tif (utn in this.hPathFn2Exts) {\n\t\t\t\tif (extptn === '') fn0 = utn;\n\t\t\t\telse for (const e3 of Object.keys(this.hPathFn2Exts[utn] ?? {})) {\n\t\t\t\t\tif (! `|${extptn}|`.includes(`|${e3}|`)) continue;\n\n\t\t\t\t\tfn0 = utn;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst h_exts = this.hPathFn2Exts[fn0!];\n\t\tif (! h_exts) throw `サーチパスに存在しないファイル【${fn}】です`;\n\n\t\tif (! ext) {\t// fnに拡張子が含まれていない\n\t\t\t//\textのどれかでサーチ（ファイル名サーチ→拡張子群にextが含まれるか）\n\t\t\tconst hcnt = int(h_exts[':cnt']);\n\t\t\tif (extptn === '') {\n\t\t\t\tif (hcnt > 1) throw `指定ファイル【${fn}】が複数マッチします。サーチ対象拡張子群【${extptn}】で絞り込むか、ファイル名を個別にして下さい。`;\n\n\t\t\t\treturn fn;\n\t\t\t}\n\n\t\t\tconst search_exts = `|${extptn}|`;\n\t\t\tif (hcnt > 1) {\n\t\t\t\tlet cnt = 0;\n\t\t\t\tfor (const e2 of Object.keys(h_exts)) {\n\t\t\t\t\tif (! search_exts.includes(`|${e2}|`)) continue;\n\t\t\t\t\tif (++cnt > 1) throw `指定ファイル【${fn}】が複数マッチします。サーチ対象拡張子群【${extptn}】で絞り込むか、ファイル名を個別にして下さい。`;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const e of Object.keys(h_exts)) {\n\t\t\t\tif (search_exts.includes(`|${e}|`)) return h_exts[e]!;\n\t\t\t}\n\t\t\tthrow `サーチ対象拡張子群【${extptn}】にマッチするファイルがサーチパスに存在しません。探索ファイル名=【${fn}】`;\n\t\t}\n\n\t\t// fnに拡張子xが含まれている\n\t\t//\tファイル名サーチ→拡張子群にxが含まれるか\n\t\tif (extptn !== '' && ! `|${extptn}|`.includes(`|${ext}|`)) {\n\t\t\tthrow `指定ファイルの拡張子【${ext}】は、サーチ対象拡張子群【${extptn}】にマッチしません。探索ファイル名=【${fn}】`;\n\t\t}\n\n\t\tconst ret = h_exts[ext];\n\t\tif (! ret) throw `サーチパスに存在しない拡張子【${ext}】です。探索ファイル名=【${fn}】、サーチ対象拡張子群【${extptn}】`;\n\n\t\treturn ret;\n\t}\n\n\tmatchPath(fnptn: string, extptn: SEARCH_PATH_ARG_EXT = SEARCH_PATH_ARG_EXT.DEFAULT): ReadonlyArray<IExts> {\n\t\tconst aRet :IExts[] = [];\n\t\tconst regPtn = new RegExp(fnptn);\n\t\tconst regExt = new RegExp(extptn);\n\t\tfor (const [fn, h_exts] of Object.entries(this.hPathFn2Exts)) {\n\t\t\tif (fn.search(regPtn) === -1) continue;\n\t\t\tif (extptn === '') {aRet.push(h_exts); continue}\n\n\t\t\tconst o :IExts = {};\n\t\t\tlet isa = false;\n\t\t\tfor (const ext of Object.keys(h_exts)) {\n\t\t\t\tif (ext.search(regExt) === -1) continue;\n\n\t\t\t\to[ext] = fn;\n\t\t\t\tisa = true;\n\t\t\t}\n\t\t\tif (isa) aRet.push(o);\n\t\t}\n\t\treturn aRet;\n\t}\n\n\taddPath(fn: string, h_exts: IExts) {\n\t\tconst o: any = {};\n\t\tfor (const [ext, v] of Object.entries(h_exts)) {\n\t\t\to[ext] = (ext.startsWith(':') ?`` :this.sys.arg.cur) + v;\n\t\t}\n\t\tthis.hPathFn2Exts[fn] = o;\n\t}\n\n}\n"],"names":["SEARCH_PATH_ARG_EXT","DEF_CFG","ConfigBase","sys","oCfg","#existsBreakline","#existsBreakpage","fn0","hExts","ext","v","hp","fn","src","hf","#REG_PATH","extptn","a","utn","e3","h_exts","hcnt","int","search_exts","cnt","e2","e","ret","fnptn","aRet","regPtn","regExt","o","isa"],"mappings":"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"}